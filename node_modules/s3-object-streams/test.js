#!/usr/bin/nodejs

var AWS = require('aws-sdk');
var s3ObjectStreams = require('s3-object-streams');

var s3ListObjectStream = new s3ObjectStreams.S3ListObjectStream();
var s3Client = new AWS.S3();

// Log all of the listed objects.
s3ListObjectStream.on('data', function (s3Object) {
  console.info(s3Object);
  //jsc = JSON.parse(s3Object);
  //console.log(s3Object.Owner.DisplayName)
  //console.log('%s,%s,%s,%s,%s', s3Object.Key, s3Object.Size, s3Object.LastModified, JSON.stringify(s3Object.Owner.DisplayName), s3Object.StorageClass);
});
s3ListObjectStream.on('end', function () {
  console.info('Listing complete.')
});
s3ListObjectStream.on('error', function (error) {
  console.error(error);
});

// List the contents of a couple of different buckets.
s3ListObjectStream.write({
  s3Client: s3Client,
  bucket: 'bucket1.starfishstorage.com',
  // Optional, only list keys with the given prefix.
  // prefix: '/',
  // Optional, group keys using a delimiter.
  //delimiter: '/',
  // Optional, defaults to 1000. The number of objects per request.
  maxKeys: 1000
});
//s3ListObjectStream.write({
//  s3Client: s3Client,
//  bucket: 'exampleBucket2'
//});
s3ListObjectStream.end();
